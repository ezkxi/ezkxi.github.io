<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üåç Trash Points Leaderboard</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <!-- jQuery CDN -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="bg-gradient">
  <main class="container my-5 p-4 rounded shadow-lg bg-white">
    <div id="header" class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-4">
      <h1 class="fw-bold text-primary mb-3 mb-md-0">üåç Trash Points Leaderboard</h1>
      <div class="d-flex gap-2 w-100 w-md-auto">
        <input type="text" id="searchBox" class="form-control" placeholder="Search by UID or Name...">
        <button class="btn btn-success" id="registerBtn">Register</button>
      </div>
    </div>

    <div id="leaderboard" class="table-responsive">
      <table id="leaderboardTable" class="table table-hover align-middle">
        <thead class="table-primary">
          <tr>
            <th scope="col">Rank</th>
            <th scope="col">UID</th>
            <th scope="col">Name</th>
            <th scope="col">Section</th>
            <th scope="col">Trash Points</th>
          </tr>
        </thead>
        <tbody>
          <!-- rows injected by jQuery -->
        </tbody>
      </table>
    </div>
  </main>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const BIN_ID = "68d7f447ae596e708ffdc6ec";
    const URL = `https://api.jsonbin.io/v3/b/${BIN_ID}/latest`;

    function loadLeaderboard() {
      $("#leaderboardTable tbody").html("<tr><td colspan='5' class='text-center'>Loading...</td></tr>");
      $.ajax({
        url: URL,
        method: "GET",
        success: function(response) {
          let data = response.record;
          let entries = Object.entries(data);
          entries.sort((a, b) => b[1].points - a[1].points);

          let tbody = $("#leaderboardTable tbody");
          tbody.empty();

          $.each(entries, function(index, [uid, info]) {
            let medal = "";
            if (index === 0) medal = "ü•á ";
            else if (index === 1) medal = "ü•à ";
            else if (index === 2) medal = "ü•â ";

            let row = `
              <tr>
                <td>${medal}${index + 1}</td>
                <td>${uid}</td>
                <td>${info.name}</td>
                <td>${info.section}</td>
                <td class="fw-bold">${info.points}</td>
              </tr>
            `;
            tbody.append(row);
          });
        },
        error: function() {
          $("#leaderboardTable tbody").html("<tr><td colspan='5' class='text-center text-danger'>Failed to load data.</td></tr>");
        }
      });
    }

    $(document).ready(function() {
      loadLeaderboard();

      $("#searchBox").on("input", function() {
        let filter = $(this).val().toLowerCase();
        $("#leaderboardTable tbody tr").each(function() {
          let text = $(this).text().toLowerCase();
          $(this).toggle(text.includes(filter));
        });
      });

      // Register button action
      $("#registerBtn").on("click", function() {
        alert("Registration form coming soon!");
      });
    });
  </script>
</body>
</html>
