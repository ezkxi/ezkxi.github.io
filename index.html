<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üåç Trash Points Leaderboard</title>
  <link rel="stylesheet" href="style.css">
  <!-- jQuery CDN -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <main>
    <div id="header">
      <h1>üåç Trash Points Leaderboard</h1>
      <input type="text" id="searchBox" placeholder="Search by UID or Name...">
    </div>
    <div id="leaderboard">
      <table id="leaderboardTable">
        <thead>
          <tr>
            <th>Rank</th>
            <th>UID</th>
            <th>Name</th>
            <th>Section</th>
            <th>Trash Points</th>
          </tr>
        </thead>
        <tbody>
          <!-- rows injected by jQuery -->
        </tbody>
      </table>
    </div>
  </main>

  <script>
    // JSONBin credentials
    const API_KEY = "$2a$10$sbJRnG/.C1CQIONF.h5qQuB3f1266FBqS3.OMJ0TZfDLwJPkr.DMy";
    const BIN_ID = "68d7f37843b1c97be9520c7a";
    const URL = `https://api.jsonbin.io/v3/b/${BIN_ID}/latest`;

    // Function to load leaderboard
    function loadLeaderboard() {
      $.ajax({
        url: URL,
        method: "GET",
        headers: { "X-Master-Key": API_KEY },
        success: function(response) {
          let data = response.record;
          let entries = Object.entries(data);

          // Sort by points (descending)
          entries.sort((a, b) => b[1].points - a[1].points);

          // Populate table
          let tbody = $("#leaderboardTable tbody");
          tbody.empty();

          $.each(entries, function(index, [uid, info]) {
            let row = `
              <tr>
                <td>${index + 1}</td>
                <td>${uid}</td>
                <td>${info.name}</td>
                <td>${info.section}</td>
                <td>${info.points}</td>
              </tr>
            `;
            tbody.append(row);
          });
        },
        error: function(xhr) {
          console.error("Error fetching data:", xhr);
          $("#leaderboardTable tbody").html("<tr><td colspan='5'>Failed to load data.</td></tr>");
        }
      });
    }

    $(document).ready(function() {
      // Load leaderboard on page load
      loadLeaderboard();

      // Search filter
      $("#searchBox").on("input", function() {
        let filter = $(this).val().toLowerCase();
        $("#leaderboardTable tbody tr").each(function() {
          let text = $(this).text().toLowerCase();
          $(this).toggle(text.includes(filter));
        });
      });
    });
  </script>
</body>
</html>
